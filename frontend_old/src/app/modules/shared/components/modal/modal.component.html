<!-- 1. Unificamos todo en un solo bloque @if para evitar redundancia -->
@if (visible) {
  <!-- ng-container es un agrupador que no añade elementos extra al DOM -->
  <ng-container>
    <div
      class="modal-backdrop"
      [@fade]
      (click)="onBackdropClick()"></div>
    <div
      class="modal-container"
      [@fade]
      role="dialog"
      aria-modal="true"
      [attr.aria-labelledby]="title ? 'modal-title-' + title : null"
      aria-describedby="modal-body-content">
      
      @if (title) {
      <app-ui-heading
        [id]="'modal-title-' + title"
        class="modal-header"
        [level]="3"
        [name]="name"
        [subtitle]="subtitle ?? null" 
        color="primary" 
        variant="solid">
        <!-- ✅ FIX: El título se pasa por proyección de contenido, no por el input [text]. -->
        {{ title }}

        @if (showCancel) {
          <app-ui-button
            class="modal-close"
            (onClick)="onClose()"
            icon="x"
            variant="icon"
            aria-label="Cerrar">
          </app-ui-button>
        }
      </app-ui-heading>
    }

    <!-- 3. Añadimos un ID para usarlo con aria-describedby -->
    <div class="modal-body" id="modal-body-content">
      <ng-content></ng-content>
    </div>

    @if (showAccept || showCancel) {
      <!-- ✅ REFACTORIZACIÓN: Usamos toolbar-buttons para unificar la gestión de botones. -->
      <app-toolbar-buttons class="modal-footer" [buttons]="footerButtons"></app-toolbar-buttons>
    }
    </div>
  </ng-container>
}