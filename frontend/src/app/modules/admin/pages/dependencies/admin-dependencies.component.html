<!-- 1. Encabezado de la página -->
<app-ui-heading [title]="pageTitle" [name]="pageIcon"></app-ui-heading>

<!-- 2. Barra de herramientas con búsqueda y botones de acción -->
  <div class="admin-toolbar">
  <app-search-box
    (valueChange)="onSearchChange($event)"
    [placeholder]="'Buscar ' + entityName.toLowerCase() + '...'">
  </app-search-box>
    <app-toolbar-buttons [buttons]="toolbarButtons"></app-toolbar-buttons>
  </div>

<!-- 3. Contenedor principal para la tabla y el paginador -->
@if (response$ | async; as response) {
  <div class="table-container">
    <!-- 4. Tabla de datos -->
    <app-table
      [items]="response.data"
      [columns]="tableColumns"
      [selection]="selection"
      [sortKey]="(sort$ | async)?.key ?? null"
      [sortOrder]="(sort$ | async)?.direction ?? 'asc'"
      (sortChange)="onSortChange($event)"
      (action)="onEdit($event.item)">
    </app-table>

    <!-- 5. Paginador -->
    @if (response.total > response.pageSize) {
      <app-paginator
        [currentPage]="response.page"
        [totalItems]="response.total"
        [pageSize]="response.pageSize"
        (pageChange)="onPageChange($event)">
      </app-paginator>
    }
  </div>
} @else if (isLoading) {
  <p>Cargando {{ entityNamePlural | lowercase }}...</p>
} @else {
  <p>No se encontraron {{ entityNamePlural | lowercase }}.</p>
}

<!-- 6. Modal para crear/editar entidades -->
<app-modal
  [visible]="isModalVisible"
  [title]="(editingEntity ? 'Editar' : 'Nuevo') + ' ' + entityName"
  (accept)="onSave()"
  (close)="closeModal()"
  [acceptDisabled]="form.invalid">
  <form [formGroup]="form" class="admin-form">
    <div class="form-field">
      <label for="name">Nombre</label>
      <input id="name" formControlName="name" type="text" placeholder="Ej: Nombre de la dependencia">
    </div>
  </form>
</app-modal>

<!-- 7. Diálogo de confirmación para eliminar -->
<app-confirm-dialog
  [visible]="isConfirmDialogVisible"
  title="Confirmar Eliminación"
  [message]="'¿Estás seguro de que deseas eliminar ' + selection.count + ' ' + (selection.count > 1 ? entityNamePlural : entityName) + '?'"
  (confirm)="onConfirmDelete()"
  (cancel)="closeConfirmDialog()">
</app-confirm-dialog>
