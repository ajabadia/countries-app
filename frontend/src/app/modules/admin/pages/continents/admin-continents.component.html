<!-- 1. Encabezado de la página -->
<!-- Se alimenta de las propiedades 'pageTitle' y 'pageIcon' de BaseAdminComponent -->
<app-ui-heading [title]="pageTitle" [icon]="pageIcon"></app-ui-heading>

<!-- 2. Barra de herramientas con búsqueda y botones de acción -->
<div class="admin-toolbar">
  <app-search-box
    (valueChange)="onSearchChange($event)"
    [placeholder]="'Buscar ' + entityName.toLowerCase() + '...'">
  </app-search-box>
  <app-toolbar-buttons [buttons]="toolbarButtons"></app-toolbar-buttons>
</div>

<!-- 3. Contenedor principal para la tabla y el paginador -->
<!-- Usamos el observable 'response$' con el pipe 'async' para manejar los datos de forma reactiva -->
@if (response$ | async; as response) {
  <div class="table-container">
    <!-- 4. Tabla de datos -->
    <app-table
      [items]="response.data"
      [columns]="tableColumns"
      [selection]="selection"
      [sortKey]="(sort$ | async)?.key ?? null"
      [sortOrder]="(sort$ | async)?.direction ?? 'asc'"
      (sortChange)="onSortChange($event)"
      (action)="onEdit($event.item)">
    </app-table>

    <!-- 5. Paginador -->
    <!-- Se muestra solo si hay más de una página de resultados -->
    @if (response.total > response.pageSize) {
      <app-paginator
        [currentPage]="response.page"
        [totalItems]="response.total"
        [pageSize]="response.pageSize"
        (pageChange)="onPageChange($event)">
      </app-paginator>
    }
  </div>
} @else if (isLoading) {
  <!-- Indicador de carga mientras se obtienen los datos -->
  <p>Cargando {{ entityNamePlural | lowercase }}...</p>
} @else {
  <!-- Mensaje si no hay datos o hubo un error -->
  <p>No se encontraron {{ entityNamePlural | lowercase }}.</p>
}

<!-- 6. Modal para crear/editar entidades -->
<app-modal
  [visible]="isModalVisible"
  [title]="(editingEntity ? 'Editar' : 'Nuevo') + ' ' + entityName"
  [acceptDisabled]="form.invalid"
  (accept)="onSave()"
  (close)="closeModal()">
  <!-- Aquí se proyectará el formulario específico para la entidad -->
  <!-- Por ahora, usamos un formulario genérico -->
  <form [formGroup]="form">
    <label for="name">Nombre:</label>
    <input id="name" formControlName="name" type="text" />
  </form>
</app-modal>

<!-- 7. Diálogo de confirmación para eliminar -->
<app-confirm-dialog
  [visible]="isConfirmDialogVisible"
  title="Confirmar Eliminación"
  [message]="'¿Estás seguro de que deseas eliminar ' + selection.count + ' ' + (selection.count > 1 ? entityNamePlural : entityName) + '?'"
  (confirm)="onConfirmDelete()"
  (close)="closeConfirmDialog()">
</app-confirm-dialog>