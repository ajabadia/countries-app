<div class="admin-page-container">
  
  <app-ui-heading
    [level]="1"
    [text]="'Administración de ' + entityNamePlural"
    [subtitle]="'Gestiona la información de los ' + entityNamePlural.toLowerCase()"
    icon="flag-detail">
  </app-ui-heading>

  <ng-container *ngIf="response$ | async as response">
    <div class="admin-toolbar">
      <app-toolbar-buttons [buttons]="toolbarButtons"></app-toolbar-buttons>
      <app-search-box (valueChange)="onSearchChange($event)" [placeholder]="'Buscar ' + entityName.toLowerCase() + '...'"></app-search-box>
    </div>

    <app-table
      [items]="response.data"
      [columns]="tableColumns"
      [selection]="selection"
      [sortKey]="(sort$ | async)?.key ?? null"
      [sortOrder]="(sort$ | async)?.order ?? 'asc'"
      (sortChange)="onSortChange($event)">
    </app-table>

    <app-paginator
      [page]="(page$ | async) ?? 1"
      [pageSize]="(pageSize$ | async) ?? 10"
      [totalItems]="response.total"
      [totalPages]="response.totalPages"
      (pageChange)="onPageChange($event)"
      (pageSizeChange)="onPageSizeChange($event)">
    </app-paginator>
  </ng-container>

  <div *ngIf="isLoading" class="loading-overlay">Cargando...</div>
</div>

<app-modal
  [visible]="isModalVisible"
  [title]="editingEntity ? 'Editar ' + entityName : 'Añadir Nuevo ' + entityName"
  [subtitle]="editingEntity ? editingEntity['default_name'] : ''" icon="flag-detail"
  (accept)="onSave()"
  (close)="closeModal()"
  [acceptDisabled]="form.invalid">
  
  <app-country-form [formGroup]="form" [isEditMode]="!!editingEntity"></app-country-form>
</app-modal>

<app-confirm-dialog
  [visible]="isConfirmDialogVisible"
  title="Confirmar Eliminación"
  [message]="'¿Estás seguro de que quieres eliminar ' + selection.count + ' ' + (selection.count === 1 ? entityName : entityNamePlural) + '? Esta acción no se puede deshacer.'"
  variant="error"
  confirmLabel="Sí, eliminar"
  (confirm)="onConfirmDelete()"
  (cancel)="closeConfirmDialog()">
</app-confirm-dialog>