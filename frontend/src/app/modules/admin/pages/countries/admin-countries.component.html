<app-ui-heading
  [level]="1"
  text="Países"
  icon="icon-country"
  iconPosition="left"
  color="primary"
  textAlign="left"
  ariaLabel="Entrar a Países">
 </app-ui-heading>


<div class="table-controls">
  <div class="controls-left">
    <!-- Tus botones: Nuevo país, Eliminar seleccionados -->
    <app-toolbar-buttons [buttons]="toolbarButtons"></app-toolbar-buttons> 
  </div>
   <div class="controls-right">
    <app-search-box
      [value]="searchTerm"
      (valueChange)="onValueChange($event)"
      placeholder="Buscar país...">
    </app-search-box>
    </div>
</div>


<table class="admin-table">
  <thead>
    <tr>
      <th>
        <app-toggle-checkbox
          [state]="generalToggleState"
          (stateChange)="onGeneralToggle($event)">
        </app-toggle-checkbox>
      </th>
      <th *ngFor="let col of tableColumns.slice(1)">
        {{col.label}}
      </th>
      
    </tr>
  </thead>
  <tbody>
    <tr
      *ngFor="let country of countries"
      [class.row-selected]="isSelected(country)"
      (click)="onRowClick(country, $event)">
      <td>
        <app-toggle-checkbox
          [state]="rowToggleState(country)"
          (stateChange)="onRowToggle(country, $event)"
          (click)="$event.stopPropagation()">
        </app-toggle-checkbox>
      </td>
      <td>{{country.defaultname}}</td>
      <td>{{country.alpha2may}}</td>
      <td>{{country.alpha3may}}</td>
      <td>{{country.numeric}}</td>
    </tr>
  </tbody>
</table>


<div style="display:flex; justify-content:center;">
<app-paginator
  [page]="page"
  [totalPages]="totalPages"
  (pageChange)="onPageChange($event)">
</app-paginator>
</div>

<!-- MODAL de creación/edición de país -->
////

<app-modal
  [visible]="showEditModal"
  [title]="editMode ? 'Editar país' : 'Nuevo país'"
  [subtitle]="editMode ? pais.defaultname : ''"
  [acceptLabel]="editMode ? 'Guardar' : 'Crear'"
  [acceptDisabled]="countryForm.invalid"
  [icon]="editMode ? 'icon-edit' : 'icon-add'"
  [iconPosition]="'left'"
  [iconSize]="'l'"
  [titleAlign]="'left'"
  [titleColor]="'primary'"
  [color]="'transparent'"
  [showClose]="true"
  (accept)="saveCountry()"
  (close)="closeCountryModal()">


  <!-- FORMULARIO de país -->


  
  <form         
       [formGroup]="countryForm"
        (ngSubmit)="saveCountry()"
        class="modal-form"
        keydown.enter="$event.preventDefault()">
    <div class="form-field">
      <label for="id" class="field-label">ID</label>
      <input class="field-input field-medium"
             placeholder=""
             type="text"
             formControlName="id"
             id="id"
             maxlength="2"
             minlength="2"
             pattern="^[a-z]{2}$"
             autocomplete="off"
             required />
      <span class="error-msg" *ngIf="countryForm.get('id')?.invalid && countryForm.get('id')?.touched">
        Debe poner dos minúsculas.
      </span>
    </div>
    <div class="form-field">
      <label for="defaultname" class="field-label">Nombre</label>
      <input type="text"
             formControlName="defaultname"
             id="defaultname"
             class="field-input field-large"
             maxlength="50"
             minlength="3"
             pattern="^[A-Za-z0-9 ]{3,50}$"
             autocomplete="off"
             required />
      <span class="error-msg" *ngIf="countryForm.get('defaultname')?.invalid && countryForm.get('defaultname')?.touched">
        Debe poner entre tres y cincuenta caracteres.
      </span>
    </div>
    <div class="form-field">
      <label for="alpha2may" class="field-label">Alpha-2</label>
      <input type="text"
             formControlName="alpha2may"
             id="alpha2may"
             class="field-input field-medium"
             maxlength="2"
             minlength="2"
             pattern="^[A-Z]{2}$"
             autocomplete="off"
             required />
      <span class="error-msg" *ngIf="countryForm.get('alpha2may')?.invalid && countryForm.get('alpha2may')?.touched">
        Debe poner dos mayúsculas.
      </span>
    </div>
    <div class="form-field">
      <label for="alpha3may" class="field-label">Alpha-3</label>
      <input type="text"
             formControlName="alpha3may"
             id="alpha3may"
             class="field-input field-medium"
             maxlength="3"
             minlength="3"
             pattern="^[A-Z]{3}$"
             autocomplete="off"
             required />
      <span class="error-msg" *ngIf="countryForm.get('alpha3may')?.invalid && countryForm.get('alpha3may')?.touched">
        Debe poner tres mayúsculas.
      </span>
    </div>
    <div class="form-field">
      <label for="numeric" class="field-label">Numérico</label>
      <input type="text"
             formControlName="numeric"
             id="numeric"
             class="field-input field-medium"
             maxlength="3"
             minlength="3"
             pattern="^[0-9]{3}$"
             autocomplete="off"
             inputmode="numeric"
             required />
      <span class="error-msg" *ngIf="countryForm.get('numeric')?.invalid && countryForm.get('numeric')?.touched">
        Debe poner tres números (rellene con ceros a la izquierda si es necesario).
      </span>
    </div>
    <div *ngIf="errorMsg" class="error-msg">
      {{ errorMsg }}
    </div>
  </form>
</app-modal>


<!-- Modal confirmación eliminar -->
<app-confirm-dialog
  [visible]="showConfirmDelete"
  [title]="'Eliminar país'"
  [message]="'¿Seguro que deseas eliminar este país? Esta acción no se puede deshacer.'"
  [variant]="'warning'"
  (confirm)="eliminarPais()"
  (cancel)="cancelarEliminar()"
>
</app-confirm-dialog>
